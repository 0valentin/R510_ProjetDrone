<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DroneBuilder ‚Äì Configurateur</title>
  <link rel="stylesheet" href="/styles.css" />
  <link rel="stylesheet" href="/constructeur.css" />
</head>
<body>
  <header class="header">
    <h1>üöÅ DroneBuilder</h1>
    <nav class="nav">
      <a class="btn-link" href="/">Composants</a>
      <a class="btn-link" href="/constructeur">Constructeur</a>
      <a class="btn-link" href="/builder">Drones</a>
    </nav>
  </header>

  <main class="configurateur container">
    <!-- R√âCAP EN HAUT -->
    <section id="resultConfig">
      <h3>R√©capitulatif</h3>

      <!-- Meta setup -->
      <div class="form-config" style="margin-bottom:12px;">
        <label>
          Nom du setup :
          <input id="setupName" type="text" placeholder="Ex. Freestyle 5 pouces" required />
        </label>
        <label>
          Cr√©ateur :
          <input id="creatorName" type="text" placeholder="Ton nom / pseudo" required />
        </label>
        <label>
          Type :
          <select id="setupType">
            <option value="all_in">All in</option>
            <option value="drone">Drone</option>
            <option value="radio_drone_batterie">Radio + Drone + Batterie</option>
            <option value="drone_batterie">Drone + Batterie</option>
          </select>
        </label>
        <div style="display:grid;gap:8px;align-content:center;">
          <div>Total : <strong><span id="totalPrice">0.00 ‚Ç¨</span></strong></div>
        </div>
      </div>

      <ul id="buildList"></ul>

      <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;">
        <button id="btnValider" type="button">Valider le drone</button>
      </div>
    </section>

    <!-- S√©lecteur de mode -->
    <section class="mode-toggle">
      <button id="modeFree" class="seg active" type="button" title="Choisir librement les cat√©gories">Mode libre</button>
      <button id="modeGuided" class="seg" type="button" title="Montage guid√© √©tape par √©tape">Mode guid√©</button>
    </section>

    <!-- Barre guid√©e (√©tapes) -->
    <section id="guidedBar" class="guided hidden" aria-hidden="true">
      <div class="guided-head">
        <div id="guidedInfo" class="guided-info">√âtape 1/‚Ä¶ ‚Äì ‚Ä¶</div>
        <div class="guided-actions">
          <button id="guidedPrev" type="button">‚óÄ Pr√©c√©dent</button>
          <button id="guidedSkip" type="button" class="is-ghost">Ignorer l‚Äô√©tape</button>
          <button id="guidedNext" type="button" class="btn-primary">Suivant ‚ñ∂</button>
          <button id="guidedFinish" type="button" class="btn-success hidden">Terminer ‚úî</button>
        </div>
      </div>
      <div class="guided-steps" id="guidedSteps" role="tablist" aria-label="√âtapes du montage">
        <!-- rendu dynamique -->
      </div>
      <div class="guided-note">
        La cat√©gorie affich√©e est contr√¥l√©e par le mode guid√©. Vous pouvez tout de m√™me ouvrir les filtres.
      </div>
    </section>

    <h2>Choisir les pi√®ces</h2>

    <!-- Contr√¥les -->
    <section class="controls" style="display:flex;gap:10px;flex-wrap:wrap;">
      <label>
        Cat√©gorie :
        <select id="selectCategory">
          <option value="">-- Choisir une cat√©gorie --</option>
        </select>
      </label>

      <button id="openFilters" type="button">Filtres</button>

      <button id="clearCategory" type="button" title="Ne rien s√©lectionner pour cette cat√©gorie">
        Vider la s√©lection de cette cat√©gorie
      </button>
    </section>

    <!-- Tableau pi√®ces -->
    <section class="table-wrapper" id="partsSection" style="display:none;">
      <table id="partsTable">
        <thead></thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <!-- MODAL FILTRES : Specs / Compat / Champs g√©n√©raux -->
  <div id="filtersModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="filtersTitle">
      <header class="modal-header">
        <h3 id="filtersTitle">Filtres (ex√©cut√©s c√¥t√© serveur)</h3>
        <button class="modal-close" id="closeFilters" aria-label="Fermer">‚úï</button>
      </header>

      <div class="modal-body">
        <div class="filter-grid">
          <div>
            <div class="label-legend">Specs</div>
            <div id="specsBox" class="stack"></div>
          </div>
          <div>
            <div class="label-legend">Compat</div>
            <div id="compatBox" class="stack"></div>
          </div>
          <div>
            <div class="label-legend">Champs g√©n√©raux</div>
            <div class="range-row">
              <label>Ajouter un champ
                <select id="generalFieldSelect"><option value="">(choisir)</option></select>
              </label>
              <button id="addGeneralField" type="button">Ajouter</button>
            </div>
            <div id="generalBox" class="stack"></div>
          </div>
        </div>
      </div>

      <footer class="modal-actions">
        <button id="applyFilters" class="btn-primary" type="button">Appliquer</button>
        <button id="resetFilters" type="button">R√©initialiser</button>
      </footer>
    </div>
  </div>

  <!-- MODAL JSON SORTIE -->
  <div id="jsonModal" class="modal hidden" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="jsonTitle">
      <header class="modal-header">
        <h3 id="jsonTitle">JSON de la configuration</h3>
        <button class="modal-close" id="closeJson" aria-label="Fermer">‚úï</button>
      </header>
      <div class="modal-body">
        <pre id="jsonOutput" style="max-height:50vh;overflow:auto;"></pre>
      </div>
      <footer class="modal-actions">
        <button id="downloadJson" type="button">T√©l√©charger JSON</button>
      </footer>
    </div>
  </div>

  <footer>
    <p>¬© 2025 DroneBuilder. Tous droits r√©serv√©s.</p>
  </footer>

  <script src="/constructeur.js"></script>
</body>
</html>
